<%- include('../partials/header', { title: 'Qu·∫£n l√Ω Tr√≤ ch∆°i' }) %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div class="container mt-4 pt-3"> <!-- ü©∑ th√™m kho·∫£ng c√°ch tr√™n -->
  <div class="d-flex justify-content-between align-items-center mb-4" style="margin-top: 15px;">

  <!-- N√∫t quay l·∫°i -->
<div class="d-flex justify-content-center mt-4 gap-3">
<button 
  class="btn btn-secondary fw-bold rounded-4 px-4 py-2"
  onclick="window.location.href = '/admin/games'"
>
  üîÅ L√†m m·ªõi
</button>


  <a 
    href="/admin" 
    class="btn fw-bold text-white rounded-4 px-3 py-2" 
    style="background-color: #ff5c8d; border: none; font-size: 15px;"
  >
    ‚¨ÖÔ∏è Quay l·∫°i trang Admin
  </a>
</div>



  <!-- Ti√™u ƒë·ªÅ -->
 <h1 class="text-center fw-bold text-danger" style="margin-top: -15px;">üë• Qu·∫£n l√Ω tr√≤ ch∆°i</h1>


  <!-- Thanh t√¨m ki·∫øm -->
  <form class="d-flex" method="GET" action="/admin/games">
    <input
      class="form-control me-2 border border-danger rounded-4"
      type="search"
      name="userSearch"
      placeholder="T√¨m ng∆∞·ªùi ch∆°i..."
      value="<%= typeof userSearch !== 'undefined' ? userSearch : '' %>"
      style="width: 220px;"
    >
    <button
      class="btn fw-bold text-white rounded-4"
      type="submit"
      style="background-color: #ff5c8d; border: none; padding: 8px 18px;"
    >
      üîç T√¨m
    </button>
  </form>
</div>


  <div class="card shadow-sm mb-5">
    <div class="card-header bg-info text-white fw-bold">üìà Th·ªëng k√™ ng∆∞·ªùi ch∆°i</div>
    <div class="card-body table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>T√™n ng∆∞·ªùi d√πng</th>
            <th>T·ªïng tr√≤ ch∆°i</th>
            <th>T·ªïng ƒëi·ªÉm</th>
            <th>L·∫ßn ƒëƒÉng nh·∫≠p cu·ªëi</th>
          </tr>
        </thead>
        <tbody>
          <% if (stats.length > 0) { %>
            <% stats.forEach((s, i) => { %>
              <tr>
                <td><%= i + 1 %></td>
                <td><%= s.username %></td>
                <td><%= s.total_games_played %></td>
                <td><%= s.total_score %></td>
                <td><%= new Date(s.last_login).toLocaleString('vi-VN') %></td>
                <td>
  <a href="/admin/users/edit/<%= s.id %>" class="btn btn-sm btn-warning me-1">‚úèÔ∏è S·ª≠a</a>
  <a href="/admin/users/delete/<%= s.id %>" class="btn btn-sm btn-danger" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi ch∆°i n√†y?');">üóëÔ∏è X√≥a</a>
</td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr><td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu ng∆∞·ªùi ch∆°i</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- üïπÔ∏è L·ªãch s·ª≠ ƒëi·ªÉm tr√≤ ch∆°i -->
   <!-- Thanh t√¨m ki·∫øm ng∆∞·ªùi ch∆°i -->
<div class="d-flex justify-content-end mb-3">
  <form class="d-flex" method="GET" action="/admin/games">
    <input
      class="form-control me-2 border border-danger rounded-4"
      type="search"
      name="gameSearch"
      placeholder="T√¨m ng∆∞·ªùi ch∆°i..."
      value="<%= typeof gameSearch !== 'undefined' ? gameSearch : '' %>"
      style="width: 220px;"
    >
    <button
      class="btn fw-bold text-white rounded-4"
      type="submit"
      style="background-color: #ff5c8d; border: none; padding: 8px 18px;"
    >
      üîç T√¨m
    </button>
  </form>
</div>

  <div class="card shadow-sm">
    <div class="card-header bg-success text-white fw-bold">üïπÔ∏è L·ªãch s·ª≠ ƒëi·ªÉm tr√≤ ch∆°i</div>
    <div class="card-body table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Ng∆∞·ªùi ch∆°i</th>
            <th>Lo·∫°i game</th>
            <th>ƒêi·ªÉm</th>
            <th>ƒê√∫ng</th>
            <th>Sai</th>
            <th>Combo cao nh·∫•t</th>
            <th>C·∫•p ƒë·ªô</th>
            <th>Ng√†y ch∆°i</th>
          </tr>
        </thead>
        <tbody>
          <% if (scores.length > 0) { %>
            <% scores.forEach((g, i) => { %>
              <tr>
                <td><%= i + 1 %></td>
                <td><%= g.username %></td>
                <td><%= g.game_type %></td>
                <td><%= g.score %></td>
                <td><%= g.correct_answers %></td>
                <td><%= g.wrong_answers %></td>
                <td><%= g.max_combo %></td>
                <td><%= g.level %></td>
                <td><%= new Date(g.created_at).toLocaleString('vi-VN') %></td>
                <td>
  <a href="/admin/games/edit/<%= g.id %>" class="btn btn-sm btn-warning me-1">‚úèÔ∏è S·ª≠a</a>
  <a href="/admin/games/delete/<%= g.id %>" class="btn btn-sm btn-danger" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b·∫£n ghi game n√†y?');">üóëÔ∏è X√≥a</a>
</td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr><td colspan="9" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu ƒëi·ªÉm game</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
