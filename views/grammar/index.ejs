<%- include('../partials/header') %>

<div class="container py-4">
  <h1 class="mb-4 text-center fw-bold">üìò Ng·ªØ ph√°p <%= level %></h1>

  <!-- Dropdown ch·ªçn level -->
  <div class="mb-4 text-center">
    <!-- Custom centered dropdown -->
<div id="levelSelectWrap" class="custom-select-wrap">
  <button id="csToggle" class="cs-btn" aria-haspopup="listbox" aria-expanded="false">
    <span id="csLabel"><%= level ? level : 'N5' %></span>
    <span class="cs-arrow">‚ñæ</span>
  </button>

  <ul id="csOptions" class="cs-options" role="listbox" tabindex="-1" aria-labelledby="csToggle" hidden>
    <li role="option" data-value="n5" class="cs-option">N5</li>
    <li role="option" data-value="n4" class="cs-option">N4</li>
    <li role="option" data-value="n3" class="cs-option">N3</li>
  </ul>
</div>

  </div>

  <div class="row row-cols-1 row-cols-md-2 g-4">
    <% grammars.forEach(item => { %>
      <div class="col">
        <a href="/grammar/<%= item.id %>" class="text-decoration-none">
          <div class="card shadow-sm h-100 border-0 rounded-3 hover-card">
            <div class="card-body">
              <h5 class="card-title text-primary"><%= item.structure %></h5>
              <p class="card-text text-muted"><%= item.meaning %></p>
            </div>
          </div>
        </a>
      </div>
    <% }) %>
  </div>
</div>

<script>
  (function(){
    const wrap = document.getElementById('levelSelectWrap');
    const toggle = document.getElementById('csToggle');
    const label = document.getElementById('csLabel');
    const options = document.getElementById('csOptions');
    const items = Array.from(options.querySelectorAll('.cs-option'));

    // m·ªü/ƒë√≥ng dropdown
    toggle.addEventListener('click', () => {
      const opened = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', !opened);
      options.hidden = opened;
    });

    // click b√™n ngo√†i -> ƒë√≥ng
    document.addEventListener('click', (e) => {
      if (!wrap.contains(e.target)) {
        options.hidden = true;
        toggle.setAttribute('aria-expanded', false);
      }
    });

    // ch·ªçn option
    items.forEach(it => {
      it.addEventListener('click', () => {
        const value = it.dataset.value;
        const text = it.textContent.trim();
        label.textContent = text;
        options.hidden = true;
        toggle.setAttribute('aria-expanded', false);
        // ƒëi·ªÅu h∆∞·ªõng
        window.location.href = '/grammar/' + value;
      });
    });
  })();
</script>
<style>
  /* custom centered select */
.custom-select-wrap {
  width: 100px;
  margin: 0 auto;
  position: relative;
  text-align: center;
}

/* n√∫t ch√≠nh */
.cs-btn {
  width: 100%;
  background: #fff;
  border: 2px solid #dc3545;
  color: #dc3545;
  padding: 8px 12px;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  box-shadow: 0 2px 6px rgba(220, 53, 69, 0.15);
  transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.2s ease;
}

.cs-btn:hover {
  background: #dc3545;
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 3px 8px rgba(220, 53, 69, 0.3);
}

/* icon m≈©i t√™n */
.cs-arrow {
  font-size: 0.85em;
  color: inherit;
}

/* popup danh s√°ch */
.cs-options {
  list-style: none;
  margin: 8px 0 0 0;
  padding: 6px;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: calc(100% + 6px);
  width: max-content;
  min-width: 100px;
  background: #fff;
  border-radius: 10px;
  border: 1px solid rgba(220, 53, 69, 0.2);
  box-shadow: 0 8px 24px rgba(220, 53, 69, 0.15);
  z-index: 2000;
}

/* t·ª´ng l·ª±a ch·ªçn */
.cs-option {
  padding: 8px 14px;
  text-align: center;
  cursor: pointer;
  border-radius: 8px;
  color: #dc3545;
  font-weight: 600;
  transition: 0.2s;
}

.cs-option:hover,
.cs-option[aria-selected="true"] {
  background: #ffe6e6;
  color: #b52b39;
}

/* mobile responsive */
@media (max-width: 480px) {
  .custom-select-wrap {
    width: 140px;
  }
  .cs-options {
    min-width: 140px;
    left: 50%;
    transform: translateX(-50%);
  }
}
/* üé® Chuy·ªÉn m√†u ch·ªØ ti·∫øng Nh·∫≠t sang ƒë·ªè */
.card-title, 
h5.text-primary, 
h4.text-primary, 
a.text-primary {
  color: #dc3545 !important;
}

/* Khi hover (r√™ chu·ªôt v√†o) th√¨ ƒë·ªè ƒë·∫≠m h∆°n m·ªôt ch√∫t */
.card-title:hover,
a.text-primary:hover {
  color: #b52b39 !important;
}

/* N·∫øu c√°c th·∫ª ng·ªØ ph√°p ƒëang d√πng class ri√™ng (v√≠ d·ª• grammar-title) */
.grammar-title {
  color: #dc3545 !important;
  font-weight: 600;
}

/* N·∫øu c√≥ icon hay border m√†u xanh d∆∞∆°ng, ƒë·ªïi lu√¥n sang ƒë·ªè */
.text-primary, 
.border-primary {
  color: #dc3545 !important;
  border-color: #dc3545 !important;
}

/* Gi·ªØ n·ªÅn tr·∫Øng ƒë·ªÉ tone ƒë·ªè n·ªïi b·∫≠t */
body, .card {
  background-color: #fff;
}


</style>


<%- include('../partials/footer') %>
