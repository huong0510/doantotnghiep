<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>L·ªãch s·ª≠ k·∫ø ho·∫°ch h·ªçc</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="text-center mb-4">üìú L·ªãch s·ª≠ k·∫ø ho·∫°ch h·ªçc</h2>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>T√™n h·ªçc vi√™n</th>
                <th>Tr√¨nh ƒë·ªô</th>
                <th>Ng√†y t·∫°o</th>
                <th>Chi ti·∫øt</th>
                <th>H√†nh ƒë·ªông</th>

            </tr>
        </thead>
        <tbody id="planList">
            <tr><td colspan="5" class="text-center">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
        </tbody>
    </table>

<div class="d-flex justify-content-between align-items-center my-3">
    <a href="/learning-plan" class="btn btn-secondary">‚Üê Quay l·∫°i t·∫°o k·∫ø ho·∫°ch</a>

 

  <div class="d-flex align-items-center gap-2">
    <input type="number" id="planIdInput" class="form-control" placeholder="Nh·∫≠p ID k·∫ø ho·∫°ch..." style="width: 180px;">
    <button class="btn btn-info fw-bold shadow-sm" 
            style="background: linear-gradient(90deg, #00bfff, #007bff); border: none;"
            onclick="goToAnalysis()">
      ü§ñ Ph√¢n t√≠ch nƒÉng l·ª±c (AI)
    </button>
  </div>
</div>

<script>
function goToAnalysis() {
  const id = document.getElementById('planIdInput').value.trim();
  if (!id) {
    alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ID k·∫ø ho·∫°ch tr∆∞·ªõc khi ph√¢n t√≠ch!');
    return;
  }
  window.location.href = '/learning-plan/analysis/' + id;
}
</script>


<!-- Modal xem chi ti·∫øt k·∫ø ho·∫°ch -->
<div class="modal fade" id="planModal" tabindex="-1" aria-labelledby="planModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="planModalLabel">Chi ti·∫øt k·∫ø ho·∫°ch h·ªçc</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="planDetail">ƒêang t·∫£i...</div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
async function loadPlans() {
    const res = await fetch('/learning-plan/history');
    const plans = await res.json();
    const tbody = document.getElementById('planList');
    tbody.innerHTML = '';

    if (plans.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ k·∫ø ho·∫°ch n√†o.</td></tr>';
        return;
    }

    plans.forEach(plan => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
    <td>${plan.id}</td>
    <td>${plan.student_name}</td>
    <td>${plan.level}</td>
    <td>${new Date(plan.created_at).toLocaleString()}</td>
    <td>
        <button class="btn btn-sm btn-primary" onclick="viewPlan(${plan.id})">Xem</button>
    </td>
    <td>
        <button class="btn btn-sm btn-danger" onclick="deletePlan(${plan.id})">üóë X√≥a</button>
    </td>
`;
        tbody.appendChild(tr);
    });
}

async function viewPlan(id) {
    const res = await fetch('/learning-plan/' + id);
    const plan = await res.json();
    document.getElementById('planDetail').innerText = plan.plan || 'Kh√¥ng c√≥ n·ªôi dung.';
    const modal = new bootstrap.Modal(document.getElementById('planModal'));
    modal.show();
}
async function deletePlan(id) {
    if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a k·∫ø ho·∫°ch n√†y kh√¥ng?')) return;

    const res = await fetch('/learning-plan/' + id, {
        method: 'DELETE'
    });

    if (res.ok) {
        alert('‚úÖ ƒê√£ x√≥a k·∫ø ho·∫°ch th√†nh c√¥ng!');
        loadPlans(); // t·∫£i l·∫°i danh s√°ch
    } else {
        alert('‚ùå L·ªói khi x√≥a k·∫ø ho·∫°ch.');
    }
}

// Load danh s√°ch khi trang m·ªü
loadPlans();
</script>
</body>
</html>
